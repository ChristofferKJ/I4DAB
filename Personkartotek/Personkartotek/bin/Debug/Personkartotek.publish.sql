/*
Deployment script for E18I4DABau569759

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "E18I4DABau569759"
:setvar DefaultFilePrefix "E18I4DABau569759"
:setvar DefaultDataPath "C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\"
:setvar DefaultLogPath "C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [$(DatabaseName)];


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ANSI_NULLS ON,
                ANSI_PADDING ON,
                ANSI_WARNINGS ON,
                ARITHABORT ON,
                CONCAT_NULL_YIELDS_NULL ON,
                QUOTED_IDENTIFIER ON,
                ANSI_NULL_DEFAULT ON,
                CURSOR_DEFAULT LOCAL 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET PAGE_VERIFY NONE,
                DISABLE_BROKER 
            WITH ROLLBACK IMMEDIATE;
    END


GO
ALTER DATABASE [$(DatabaseName)]
    SET TARGET_RECOVERY_TIME = 0 SECONDS 
    WITH ROLLBACK IMMEDIATE;


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET QUERY_STORE (CLEANUP_POLICY = (STALE_QUERY_THRESHOLD_DAYS = 367)) 
            WITH ROLLBACK IMMEDIATE;
    END


GO
PRINT N'Creating [dbo].[AA_Adresse]...';


GO
CREATE TABLE [dbo].[AA_Adresse] (
    [PersonID]     BIGINT         NOT NULL,
    [AdresseID]    BIGINT         NOT NULL,
    [AA_AdresseID] BIGINT         IDENTITY (1, 1) NOT NULL,
    [Type]         NVARCHAR (MAX) NOT NULL,
    CONSTRAINT [pk_AA_Adresse] PRIMARY KEY CLUSTERED ([PersonID] ASC, [AdresseID] ASC, [AA_AdresseID] ASC)
);


GO
PRINT N'Creating [dbo].[Adresse]...';


GO
CREATE TABLE [dbo].[Adresse] (
    [AdresseID] BIGINT         IDENTITY (1, 1) NOT NULL,
    [ByID]      BIGINT         NOT NULL,
    [Vej]       NVARCHAR (MAX) NOT NULL,
    [Husnummer] NVARCHAR (MAX) NOT NULL,
    CONSTRAINT [pk_Adresse] PRIMARY KEY CLUSTERED ([AdresseID] ASC)
);


GO
PRINT N'Creating [dbo].[Byy]...';


GO
CREATE TABLE [dbo].[Byy] (
    [ByID]       BIGINT         IDENTITY (1, 1) NOT NULL,
    [Postnummer] NVARCHAR (MAX) NOT NULL,
    [Land]       NVARCHAR (MAX) NOT NULL,
    [Bynavn]     NVARCHAR (MAX) NOT NULL,
    CONSTRAINT [pk_By] PRIMARY KEY CLUSTERED ([ByID] ASC)
);


GO
PRINT N'Creating [dbo].[Emailadresse]...';


GO
CREATE TABLE [dbo].[Emailadresse] (
    [EmailID]  BIGINT         IDENTITY (1, 1) NOT NULL,
    [PersonID] BIGINT         NOT NULL,
    [Email]    NVARCHAR (MAX) NOT NULL,
    CONSTRAINT [pk_Email] PRIMARY KEY CLUSTERED ([EmailID] ASC)
);


GO
PRINT N'Creating [dbo].[Noter]...';


GO
CREATE TABLE [dbo].[Noter] (
    [NoterID]  BIGINT         IDENTITY (1, 1) NOT NULL,
    [Note]     NVARCHAR (MAX) NOT NULL,
    [PersonID] BIGINT         NOT NULL,
    CONSTRAINT [pk_Note] PRIMARY KEY CLUSTERED ([NoterID] ASC)
);


GO
PRINT N'Creating [dbo].[Operatoer]...';


GO
CREATE TABLE [dbo].[Operatoer] (
    [OperatoerID] BIGINT         IDENTITY (1, 1) NOT NULL,
    [Navn]        NVARCHAR (MAX) NOT NULL,
    CONSTRAINT [pk_Operatoer] PRIMARY KEY CLUSTERED ([OperatoerID] ASC)
);


GO
PRINT N'Creating [dbo].[Person]...';


GO
CREATE TABLE [dbo].[Person] (
    [PersonID]   BIGINT         IDENTITY (1, 1) NOT NULL,
    [AdresseID]  BIGINT         NOT NULL,
    [Fornavn]    NVARCHAR (MAX) NOT NULL,
    [Mellemnavn] NVARCHAR (MAX) NOT NULL,
    [Efternavn]  NVARCHAR (MAX) NOT NULL,
    [Type]       NVARCHAR (MAX) NOT NULL,
    CONSTRAINT [pk_Person] PRIMARY KEY CLUSTERED ([PersonID] ASC)
);


GO
PRINT N'Creating [dbo].[Telefon]...';


GO
CREATE TABLE [dbo].[Telefon] (
    [TeleID]        BIGINT         IDENTITY (1, 1) NOT NULL,
    [PersonID]      BIGINT         NOT NULL,
    [OperatoerID]   BIGINT         NOT NULL,
    [Telefonnummer] NVARCHAR (MAX) NOT NULL,
    CONSTRAINT [pk_Telefon] PRIMARY KEY CLUSTERED ([TeleID] ASC)
);


GO
PRINT N'Creating [dbo].[fk_AA_Adresse]...';


GO
ALTER TABLE [dbo].[AA_Adresse] WITH NOCHECK
    ADD CONSTRAINT [fk_AA_Adresse] FOREIGN KEY ([PersonID]) REFERENCES [dbo].[Person] ([PersonID]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[fk_AA_Adresse2]...';


GO
ALTER TABLE [dbo].[AA_Adresse] WITH NOCHECK
    ADD CONSTRAINT [fk_AA_Adresse2] FOREIGN KEY ([AdresseID]) REFERENCES [dbo].[Adresse] ([AdresseID]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[fk_Adresse]...';


GO
ALTER TABLE [dbo].[Adresse] WITH NOCHECK
    ADD CONSTRAINT [fk_Adresse] FOREIGN KEY ([ByID]) REFERENCES [dbo].[Byy] ([ByID]) ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[fk_Email]...';


GO
ALTER TABLE [dbo].[Emailadresse] WITH NOCHECK
    ADD CONSTRAINT [fk_Email] FOREIGN KEY ([PersonID]) REFERENCES [dbo].[Person] ([PersonID]) ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[fk_Note]...';


GO
ALTER TABLE [dbo].[Noter] WITH NOCHECK
    ADD CONSTRAINT [fk_Note] FOREIGN KEY ([PersonID]) REFERENCES [dbo].[Person] ([PersonID]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[fk_Person]...';


GO
ALTER TABLE [dbo].[Person] WITH NOCHECK
    ADD CONSTRAINT [fk_Person] FOREIGN KEY ([AdresseID]) REFERENCES [dbo].[Adresse] ([AdresseID]);


GO
PRINT N'Creating [dbo].[fk_Telefon]...';


GO
ALTER TABLE [dbo].[Telefon] WITH NOCHECK
    ADD CONSTRAINT [fk_Telefon] FOREIGN KEY ([PersonID]) REFERENCES [dbo].[Person] ([PersonID]) ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[fk_Telefon2]...';


GO
ALTER TABLE [dbo].[Telefon] WITH NOCHECK
    ADD CONSTRAINT [fk_Telefon2] FOREIGN KEY ([OperatoerID]) REFERENCES [dbo].[Operatoer] ([OperatoerID]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Checking existing data against newly created constraints';


GO
USE [$(DatabaseName)];


GO
ALTER TABLE [dbo].[AA_Adresse] WITH CHECK CHECK CONSTRAINT [fk_AA_Adresse];

ALTER TABLE [dbo].[AA_Adresse] WITH CHECK CHECK CONSTRAINT [fk_AA_Adresse2];

ALTER TABLE [dbo].[Adresse] WITH CHECK CHECK CONSTRAINT [fk_Adresse];

ALTER TABLE [dbo].[Emailadresse] WITH CHECK CHECK CONSTRAINT [fk_Email];

ALTER TABLE [dbo].[Noter] WITH CHECK CHECK CONSTRAINT [fk_Note];

ALTER TABLE [dbo].[Person] WITH CHECK CHECK CONSTRAINT [fk_Person];

ALTER TABLE [dbo].[Telefon] WITH CHECK CHECK CONSTRAINT [fk_Telefon];

ALTER TABLE [dbo].[Telefon] WITH CHECK CHECK CONSTRAINT [fk_Telefon2];


GO
PRINT N'Update complete.';


GO
